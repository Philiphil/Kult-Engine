<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>KULT-ENGINE:: DOCCUMENTATION</title>
</head>
<body>

	<style>
		html{
			width: 80%;
			margin-left: auto;
			margin-right: auto;
		}
		.center{
			text-align: center;
		}
		div{
			margin : 0;
			padding: 0;
		}
		.chapitre{
			padding-bottom: 15px;
			margin-top: 50px;
			margin-left: 10px;
			margin-bottom: 50px;
			border-bottom: 1px darkgrey solid;
		}
		.mini_chapitre{
			padding-bottom: 10px;
			margin-top: 25px;
			margin-left: 25px;
			margin-right: 35px;
			margin-bottom: 25px;
			border-bottom: 1px lightgrey solid;
		}
		h1,h2,h3,h4,h5,h6,p,ul{
			margin-top: 5px;
			margin-bottom: 5px;
		}

		p{
			margin-top: 2.5px;
			margin-bottom: 2.5px;
		}
	</style>

	<div class='chapitre center'>
			<h1>Documentation du framework Kult-Engine</h1>
			<br>
			<p>
				Kult-Engine<br>
				07/09/2016<br>
				Théo Sorriaux<br>
				171012@supinfo.com<br>
				https://github.com/Philiphil<br>
				PHP 5.5<br>
			</p>
		</div>
		<div class='chapitre center'>
			<h2>SOMMAIRE</h2>
			<ul id='sommaire'>
				<li><a href='#archi'>Architecture du Kult-Engine</a></li>
				<li><a href='#elements'>Elements du Kult-engine</a></li>
				<ul>
					<li><a href='#elem_config'>config.php</a></li>
					<li><a href='#elem_invoker'>invoker.class.php</a></li>
					<li><a href='#elem_page'>page.class.php</a></li>
					<li><a href='#elem_texte'>texte.php</a></li>
					<li><a href='#elem_fonc'>fonction.php</a></li>
					<li><a href='#elem_logger'>logger.class.php</a></li>
					<li><a href='#elem_connector_factory'>connector.factory.php</a></li>
					<li><a href='#elem_connector_class'>connector.class.php</a></li>
					<li><a href='#elem_membre'>membre.class.php</a></li>
					<li><a href='#elem_jsclass'>javascript.class.php</a></li>
					<li><a href='#elem_ajax'>ajax.class.php</a></li>
					<li><a href='#elem_cache'>cache.class.php</a></li>
				</ul>
				<li><a href='#struc'>STRUCTURE D'UNE PAGE</a></li>
				<li><a href='#strucapi'>Structure d'un script api php</a></li>
				<li><a href='#strucapiajax'>Structure d'un script api php ajax</a></li>
			</div>



			<div id="archi" class='chapitre'>
				<h3>Architecture du Kult-Engine</h3>
				<div  class='mini_chapitre'>
					<h4>Organisation</h4>
					<p>
						l'architecture reprend le model MVC<br><br>
						&emsp;Avec ./controller contenant la partie Control<br>
						&emsp;&emsp;Avec dedans <br>
						&emsp;&emsp;./controller/connector.class.php<br>
						&emsp;&emsp;./controller/connector.factory.php<br>
						&emsp;&emsp;./controller/fonction.php<br>
						&emsp;&emsp;./controller/javascript.class.php<br>
						&emsp;&emsp;./controller/logger.class.php<br>
						&emsp;&emsp;./controller/texte.script.php<br><br>
						&emsp;Avec ./model contenant la partie Model<br>
						&emsp;&emsp;Avec dedans <br>
						&emsp;&emsp;./model/vendor/ (ext libs)<br>
						&emsp;&emsp;./model/membre.class.php <br>
						&emsp;&emsp;./model/textes.php <br>
						&emsp;&emsp;./model/page.class.php <br><br>
						&emsp;Avec ./www contenant la partie Vue<br>
						&emsp;&emsp;Avec dedans <br>
						&emsp;&emsp;./www/invoker.class.php <br><br>
						&emsp; Et<br>
						&emsp;./config.php<br>
					</p>
				</div>
				<div  class='mini_chapitre'>
					<h4>Fonctionnement</h4>
					<p>
						Les principales fonctionnalités reposent entre les mains de classes singletons<br>
						<br>

						./www/invoker.class.php est appelé depuis les pages et permet l'invocation et l'initialisation de chaques parties du framework<br>
						&emsp; le necessaire est invocable avec invoker::require_basics($foo);<br>
						<br>

						./model/invokee.class.php est appelée par invoker::require_basics();<br>
						&emsp; Il est une second partie d'invoker servant à invoquer les script locaux externe au framework necessitant d'être là, les libs externes, les classes model...<br>
						<br>

						./config.php est appelée par invoker::require_basics();<br>
						&emsp; Il contient toutes les informations necessaire au fonctionnement du KULT ENGINE sur le serveur<br>
						<br>

						./model/membre.class.php est appelée par invoker::require_basics();<br>
						&emsp; Il gère et contient les sessions<br>
						<br>

						./model/page.class.php est appelée par invoker::require_basics();<br>
						&emsp; Il permet l'invocation d'element html<br>
						<br>

						./controller/texte.script.php est appelé par invoker::require_basics(), il ne s'agit pas d'une classe;<br>
						&emsp; get_texte($key) retourne les textes dans la langue appropriée<br>
						<br>

						./controller/connector.class.php est appelée par invoker::require_basics();<br>
						&emsp; Il gère toute forme de query.<br>
						&emsp; Il hérite la methode setter() de ./controller/connector.factory.php qui est une classe abstraite servant à découpler connector.<br>
						&emsp; setter() permet d'initialiser la connexion à la db sql.<br>
					</p>
				</div>

			</div>

			<div id="elements" class='chapitre'>
				<h3>Les elements principaux du Kult-Engine</h3>

				<div id="elem_config" class='mini_chapitre'>
					<h4>config.php</h4>
					<p>
						config.php est conçu de sorte à être le seul fichier à modifier pour deplacer le site d'un serveur distinc à un autre, il contient les mots de passe sql, les routes, le type de systeme, les communauty snmp ...<br>

					</p>
				</div>

				<div id="elem_invoker" class='mini_chapitre'>
					<h4>invoker.class.php</h4>
					<p>
						invoker.class.php est la classe assurant l'invocation des constantes de config.php<br>
					</p>
					<h5>Fonctions principales</h5>
					<p>
						invoker::require_bacis($arg) : Invoque les elements basiques necessaires au bon fonctionnement du framework.<br>
						&emsp;$arg correspond au niveau de config.php par rapport à la page qui l'invoque, exemples : <br>
						&emsp;&emsp;vide ou '../' : les pages au niveau www/page.php<br>
						&emsp;&emsp;'api' ou '../../' : les pages au niveau www/dossier/page.php<br>
					</p>
				</div>

				<div id="elem_page" class='mini_chapitre'>
					<h4>page.class.php</h4>
					<p>
						page.class.php contient les elements HTML et permet d'invoquer facilement en une ligne les blocs récurents.<br>
					</p>
					<h5>Fonctions principales</h5>
					<p>
						page::standardpage_head(Titre_de_la_page) : balise &lt;head> d'une page<br>
						page::standardpage_header() : balise &lt;header> d'une page<br>
						page::standardpage_body_begin(fil_d_arianne) : ouverture container html<br>
						page::standardpage_body_end() : ouverture container html<br>
						page::standardpage_footer() : balise &lt;footer> d'une page<br>
					</p>
				</div>

				<div id="elem_texte" class='mini_chapitre'>
					<h4>textes.php</h4>
					<p>
						contient les texte affichés dans les pages<br>
					</p>
					<h5>Fonctions principales</h5>
					<p>
						textes() : retourne l'array contenant tout les textes.<br>
						&emsp;&emsp;$array["fr"]["salut"] = "Salut";<br>
					</p>
				</div>
				<div id="elem_texte_script" class='mini_chapitre'>
					<h4>texte.script.php</h4>
					<p>
						permet l'accèe aux textes de get_texte
					</p>
					<p>
						get_texte($texte) : retourne le texte dans la langue préférée de l'utilisateur, ou la langue par défaut si aucune ne correspond.<br>
						&emsp;$texte correspond à la clé permetant d'acceder au texte.<br>
						&emsp;&emsp;exemples:<br>
						&emsp;&emsp;get_texte('salut') // return 'Salut';<br>
						get_lang() : retourne la langue préférée du navigateur de l'utilisateur ou la langue par défaut du serveur si non disponible.
					</p>
				</div>

				<div id="elem_fonc" class='mini_chapitre'>
					<h4>fonction.php</h4>
					<p>
						contient les fonctions récurents utilisées un peu partout<br>
					</p>
					<h5>Fonctions principales</h5>
					<p>
						timer_init() et timer_get() : timer init est lancée à l'invocation de fonction.php, il initialise un chrono, récupérarble par timer_get (idéalement appelée au fin fond du footer);<br>
						redirect($page,$secondes) : redirige sur $page au bout de $seconde secondes.<br>
						echo_br() : fais un echo '&lt;br>&lt;br>'; particulierement utile pour le debug.<br>
					</p>
				</div>


				<div id="elem_logger" class='mini_chapitre'>
					<h4>logger.class.php</h4>
					<p>
						gère l'écriture de log<br>
					</p>
					<h5>Fonctions principales</h5>
					<p>
						logger::write('$texte'); : log $texte et des informations sur la navigation sur le serveur syslog designé.<br>
					</p>
				</div>

				<div id="elem_connector_factory" class='mini_chapitre'>
					<h4>connector.factory.php</h4>
					<p>
						factory de connector<br>
					</p>
					<h5>Fonctions principales</h5>
					<p>
						etre extend par connector.class.php<br>
					</p>
				</div>

				<div id="elem_connector_class" class='mini_chapitre'>
					<h4>connector.class.php</h4>
					<p>
						Centralisation des requettes faites à la DB<br>
					</p>
				</div>


				<div id="elem_membre" class='mini_chapitre'>
					<h4>membre.class.php</h4>
					<p>
						model de session, centralisation de toutes les variables $_SESSION relative à la navigation de l'utilisateur<br>
					</p>
					<h5>Fonctions principales</h5>
					<p>
						membre::setter() : initialise membre.class.php<br>
						membre::login_required() : redirige l'utilisateur non connecté<br>
						membre::is_on_login_page(); return 1 si l'utilisateur est sur la page de login sinon 0<br>
						membre::connexion() : assure la connexion de l'utilisateur, le stockage et la récuperation des variables de sssession <br>
					</p>
				</div>

				<div id="elem_jsclass" class='mini_chapitre'>
					<h4>javascript.class.php</h4>
					<p>
						permet la communication des constantes de route de php à javascript à travers la super class kons<br>
					</p>
				</div>

				<div id="elem_ajax" class='mini_chapitre'>
					<h4>ajax.class.js</h4>
					<p>
						assure, contient, centralise et normalise les requettes ajax, avec l'object javascript ReqAjax.<br>
						stock les url dans la superclass UrlAjax<br>
					</p>
					<h5>Fonctions principales</h5>
					<p>
						Creation de l'objet<br>
						var obj = ReqAjax("nomDeLaRequette", paramettre_de_la_requette);<br>
						Envoie de la requette :<br>
						obj.send('UrlAjax.destination');<br>
						obj.send('UrlAjax.destination', function(callback){<br>
						callback = "Valeur de retour recuperable, si pas de retour callback =1 par defaut"<br>
					</p>
				</div>

				<div id="elem_cache" class='mini_chapitre'>
					<h4>cache.class.js</h4>
					<p>
						Permet le caching des inputs<br>
					</p>
					<h5>Fonctions principales</h5>
					<p>
						k-caching="cleunique", cache cet element en js sous la forme localStorage[cleunique] dès qu'il subit un event CHANGE<br>
						k-caching-onload, indique que le cache de l'element k-catching doit se faire au chargement de la page<br>
						k-catching-dependency="cle_unique_de_lelement_dont_celui_depend" : indique que le cache doit s'effectuer si l'element k-caching="cle_unique_de_lelement_dont_celui_depend" est égal à la valeur qu'il eut au moment où l'element portant l'attribut html k-catching-dependency="cle_unique_de_lelement_dont_celui_depend" a reçu l'evennement CHANGE<br>
					</p>
				</div>


			</div>



			<div id='struc' class='chapitre'>
				<h3>Structure type d'une page.</h3>
				<code>
					&lt;php<br>
					&emsp;include("invoker.class.php");<br>
					&emsp;#L'invoker permet depuis les pages (vue) l'invocation de tout les elements controlleur/model requis.<br>
					&emsp;invoker::require_basics();<br>
					&emsp;/*L'invocation se fait avec cette methode, qui prend un argument correspondant à la distance du fichier de conf<br>
					&emsp;invoker::require_basics('../'); dans l'exemple d'un www/page.php invoquant conf.php situé au niveau de www/ '../' est l'argument par défaut.<br>
					&emsp;invoker::require_basics('../../'); ou invoker::require_basics('api'); pour ce qui est à deux niveau.<br>
					&emsp;*/<br>
					&emsp;page::standardpage_head('Title');<br>
					&emsp;#La balise &lt;head> d'une page standard.<br>
					<br>
					&emsp;page::standardpage_header();<br> 
					&emsp;#le &lt;header> d'une page standard<br>
					<br>
					page::standardpage_body_begin();<br>
					#Le container standard d'une page tout aussi standard.<br>
					?><br>
					<br>
					&lt;p> C'est donc ici que l'on écrit le html&lt;/p>
					<br>				
					&lt;?php<br>
					page::standardpage_body_end();<br>
					#Les balises fermant le container html<br>
					<br>
					page::standardpage_footer();<br>
					#le footer standard de ma page ... standard<br>
					?>
				</code>
			</div>




			<div id="strucapi" class='chapitre'>
				<h3>Structure d'une page de type api/page.script.php</h3>
				<code>
					&lt;?php<br>
					&emsp;require_once("../invoker.class.php");<br>
					&emsp;invoker::require_basics('api');<br>
					#la place des scripts étant ./www/api/<br>
					&emsp;membre::login_required();<br>
					#en admetant que la connexion soit requise.<br>
					<br>

					&emsp;switch ($_POST["fonc"]) {<br>
					#convention<br>
					&emsp;&emsp;case 'val':<br>
					&emsp;&emsp;&emsp;fonction($_POST["arg"]);<br>
					&emsp;&emsp;&emsp;break;<br>
					&emsp;}<br>
					&emsp;fonction($arg)<br>
					&emsp;{<br>
					<br>
					&emsp;}<br>

				</code>
			</div>


			<div id="strucapiajax" class='chapitre'>
				<h3>Structure d'une page de type api/page.ajax.php</h3>
				<p>
					Ce type de page est contactée par un object de type ReqAjax.
				</p>
				<code>
					&lt;?php<br>
					&emsp;require_once("../invoker.class.php");<br>
					&emsp;invoker::require_basics('api');<br>
					&emsp;membre::login_required();<br>
					<br>

					&emsp;$req = $_POST['req'];<br>
					&emsp;$args = $_POST['args'];<br>
					<br>

					&emsp;switch ($req) {<br>
					&emsp;&emsp;case 'val':<br>
					&emsp;&emsp;&emsp;fonction($args);<br>
					&emsp;&emsp;&emsp;break;<br>
					&emsp;}<br>
					&emsp;fonction($args)<br>
					&emsp;{<br>
					<br>
					&emsp;}<br>

				</code>
			</div>









		</body>